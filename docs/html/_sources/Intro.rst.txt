.. _sec0:

===========================
はじめに
===========================

:author: qh73xe
:Last Change: 25-May-2024.

.. contents::
    :depth: 2

.. _sec0cap1:

このパートで行うこと
===========================

- この資料で扱う内容を理解する
- Python の実行環境を理解する
- 音声の解析に必要なライブラリをインストールする
- Web アプリケーションに必要な環境を構築する

.. _sec0cap2:

今日やること
===========================

こんにちは. 早稲田大学, 菊池研究室博士浅井です.

本日は :code:`Open Smile` についてお話をしていこうと思います.

その前に軽いアイスブレイクとして簡単な自己紹介から始めていこうかなと思います.
浅井は, 最近アクアリウムを趣味にしています.
アクアリウム皆さんご存知でしょうか？
以下の写真のようなものですね.

.. figure:: ./fig/aqua.jpg
   :align: center
   :width: 100%

このアクアリウム,
生き物を飼育する趣味だと思われがちですが実は違います.
じゃあなんだと言われると, 水であるとか、光であるとか、
目に見えない要素をコントロールすることで、
望ましい, きれいな風景を作っていくゲームになります.

パラメータ設定を間違えると, 苔がでたり, 水が濁ったり, 生体が死んだりします.
逆に, 適切なパラメータ設定をすると, きれいな水景が簡単に維持できるようにもなります.

しかしコントロールをしたいものは, 水の中に溶けているため目には見えないんですよね.
あるいは, 光の量や時間も操作することはできるのですが,
それが適切なのかはなかなか分かりません.
なんとかして, 目には見えないものの今の状態を知ることが重要になります.

そこで, どうするかと言うと大きく2つの方法があります。

1 つ目は水槽を良く観察するという方法です.
周囲のもの, 例えばコケの量であるとか, 中に入っている生体の状態から予測していく方法です.
経験豊富な達人になると, これが一番, 早くて正確だったりするのですけど, 
経験がないと, なかなか難しい.

2 つ目の方法は, 試験薬を使って数値で計測すると言う方法です.
有名なものを挙げれば, リトマス紙を使って pH を計測するみたいな方法です.
この方法の良いところは, 経験がなくても今の状態を把握できることです.
経験がなくとも pH 7 となれば中性なのだとわかります.

しかし, この方法にも欠点はあります.
例えば pH は, 水に溶解している酸性物質とアルカリ性物質のどちらが多いかという指標なのですが,
これは両方多い汚い水も, 両方少ない綺麗な水も, 割合が同じなら同じ値が出でしまいます.
つまり, 測っているものが何かということをきちんと知らないと間違った判断をしてしまうのです.

今日お話しをする Open Smile は, 実はリトマス試験紙と同じようなツールです.
これは, 水の性質ではなく, 音の性質を測るツールです.
音という目に見えないものから, その特性がどのようになっているのかを
特定の指標で計測するリトマス試験紙みたいなものです.

リトマス試験紙が水につければ良いだけのように,
OpenSmile も音声に対して特定のコマンドを利用すればさまざまな指標を算出してくれます.
ただ, pH と同じように, 何を測っているものなのかを知らないと,
案外間違った判断をしてしまうこともあります.

今日のチュートリアルでは,
この音を検査する方法について解説をしていき,
実際に音声を収録して音響特徴量を算出するところまで解説できれば良いなと思います.

.. _sec0cap3:

開発環境の構築 (PYTHON 編)
=============================

まずは, 音響特徴量を計測するための計測器の準備をしていきましょう.
この計測器は, :code:`Python` で作成されているため, :code:`Python` の実行環境を整える必要があります.

この実行環境は大きく 2 種類あります.
1 つ目はクラウド環境, つまり Web サービスで実行する方法です.
これはブラウザ上で Python のコードを実行できるサービスです.
:code:`Google Colab` はその代表例です.
:code:`Google Colab` の場合 :code:`Google` のサーバー上で :code:`Python` のコードを実行します.
事前にいくつかの設定が行われていて, 気軽に試せることが特徴です.

- 特にビデオカードのような高い機材を必要とする場合にはこの方法が便利です.

しかし Google から見えないデータにはアクセスできません.
基本的に問題になることは少ないのですが, 音声の録音機材を操作するためには,
ちょっとした裏技が必要になります.

- だって勝手にマイクとかビデオとか操作されて, 部屋の様子とか取られたらすごく嫌ですよね.

2 つ目の方法は, ローカル環境で :code:`Python` を実行する方法です.
これは自分の PC に :code:`Python` をインストールして, その上でコードを実行する方法です.
欠点は, 自分自身で正しい環境を構築しないといけないことです.
逆に言えば, 相応の知識があれば, 何でもできるということです.

- そのため最終的にはローカル環境の方が便利で簡単になることが多いです.

Google Colab 環境
------------------------------------

今回のチュートリアルではクラウド環境 :code:`Google Colab` を使用します.
音声の録音が行いにくいという欠点はありますが,
事前準備がなくともすぐに実行できるため, チュートリアルの進行がスムーズになります.

- あくまでチュートリアルの進行がスムーズため :code:`Google Colab` を
  利用することにしているため実際のローカル環境を使用することをお勧めします.

:code:`Google Colab` 環境を使用するためには, 以下の手順を実行してください.

- まず, ブラウザを開きます
- 次に Google にログインしていることを確認してください.
- その後 Google Drive を開きます.
- マイドライブの中にディレクトリを作成します
  - 例えば `OpenSmileTutorial` という名前でディレクトリを作成します.
- 作成したディレクトリに入り, 右クリック (二つ指でクリック) し, 「その他」 → 「Google Colabolatory」を選択します.
- Untitled0.ipynb と書かれた箇所を選択し, 名称を決めます.
  - 今回は `Google Colab の使い方.ipynb` という名前にしましょう.

その他, このツールの使い方はチュートリアルの本題からは外れるので口頭で説明をします.

- 基本的な使い方
    - https://www.kikagaku.co.jp/kikagaku-blog/google-colab-howto/
- Google Drive へのアクセス方法
    - https://www.kikagaku.co.jp/kikagaku-blog/google-colab-drive-mount/


ローカル 環境
------------------------------------

ローカル環境を構築するためには, 以下の手順を実行してください.
まず, そもそもで :code:`Python3` がインストールされているか確認してください.
Python 3 系をインストールしていない場合は, 以下の手順でインストールしてください::

    $ brew install python3

それが終わったらチュートリアル用のディレクトリを作成しましょう::

    $ mkdir OpenSmileTutorial
    $ cd OpenSmileTutorial

このディレクトリに対して, 仮想環境を作成します.
仮想環境とは,
あるプロジェクトに必要なライブラリをインストールするための環境です.
プロジェクトごとに必要なライブラリは変化しますし,
バージョンも異なることがあるため,
一般に, python を利用する場合,
ディレクトリごとにライブラリをインストールすることが推奨されています::

    $ python3 -m venv venv
    $ source venv/bin/activate

以後, このチュートリアルを実施する際には,
はじめに一回 `source venv/bin/activate` を実行してください.
なお, 今後の記述は全て, 仮想環境を有効にした状態で行うことを前提とします.

続いて必要なライブラリをインストールします::

    $ pip install setuptools wheel ipython # python 用インタラクティブシェル
    $ pip install numpy scipy matplotlib pandas  # 数値計算用及び可視化ライブラリ
    $ pip install pyworld  # 最も基本的な音響解析ツール. 2 章で使用.
    $ pip install opensmile  # 今回の主題である音響解析ツール. 3 章で使用.
